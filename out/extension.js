var w=(t,e)=>()=>(e||t((e={exports:{}}).exports,e),e.exports);var H=w((Fn,B)=>{var k=require("vscode"),z=require("path"),J=class{static get providedCodeActionKinds(){return[k.CodeActionKind.QuickFix]}provideCodeActions(e,n,s){let i=s.diagnostics,a=[];return i.forEach(o=>{o.code==="create-file"?a.push(this.createFileQuickFix(o.packageNameOrFilePath,e),this.createFilesQuickFix(e)):o.code==="install-package-global"?a.push(this.installPackageQuickFix(o.packageNameOrFilePath,e),this.installPackageGlobalQuickFix(o.packageNameOrFilePath,e),this.installMissingPackagesFix(e),this.installMissingPackagesGloballyFix(e)):o.code==="install-package-this-project"&&a.push(this.installPackageQuickFix(o.packageNameOrFilePath,e),this.installMissingPackagesFix(e),this.installMissingPackagesGloballyFix(e))}),a}createFileQuickFix(e,n){let s=new k.CodeAction("Create missing file",k.CodeActionKind.QuickFix),i=z.resolve(z.dirname(n.fileName),e);return s.command={title:"Create file",command:"npm-module-checker.createFile",arguments:[i,n]},s}createFilesQuickFix(e){let n=new k.CodeAction("Fix all problems (create all missing files)",k.CodeActionKind.QuickFix);return n.command={title:"Create files",command:"npm-module-checker.createAllMissingFiles",arguments:[e]},n}installPackageQuickFix(e,n){let s=new k.CodeAction(`Install "${e}" package in this project`,k.CodeActionKind.QuickFix);return s.command={title:"Install package",command:"npm-module-checker.installPackage",arguments:[e,n]},s}installPackageGlobalQuickFix(e,n){let s=new k.CodeAction(`Install "${e}" package globally`,k.CodeActionKind.QuickFix);return s.command={title:"Install global package",command:"npm-module-checker.installGlobalPackage",arguments:[e,n]},s}installMissingPackagesFix(e){let n=new k.CodeAction("Fix all problems (install missing packages) in this project",k.CodeActionKind.QuickFix);return n.command={title:"Fix all problems (install missing packages) in this project",command:"npm-module-checker.installMissingPackagesFix",arguments:[e]},n}installMissingPackagesGloballyFix(e){let n=new k.CodeAction("Fix all problems (install missing packages) globally",k.CodeActionKind.QuickFix);return n.command={title:"Fix all problems (install missing packages) globally",command:"npm-module-checker.installMissingPackagesGloballyFix",arguments:[e]},n}};B.exports=J});var G=w((wn,X)=>{var Ae=require("vscode"),R=Ae.window.createOutputChannel("NPM package checker");function Ee(t,e=!0){R.appendLine(t),e&&R.show()}X.exports={outputChannel:R,showOutput:Ee}});var ee=w((Pn,Z)=>{var Ge=require("fs"),Qe=require("path");function Te(t,e){try{let n=Qe.join(t,e);return Ge.existsSync(n)}catch{return!1}}Z.exports=Te});var te=w((yn,ne)=>{var Ke=require("fs"),Q=require("path");function We(t){let e=Q.dirname(t);for(;e!==Q.parse(e).root;){let n=Q.join(e,"package.json");if(Ke.existsSync(n))return n;e=Q.dirname(e)}return null}ne.exports=We});var ie=w((Cn,se)=>{var Je=require("vscode"),L=class extends Je.Diagnostic{packageNameOrFilePath;line;startPos;endPos};function Re(t,e,n,s,i,a,o,d){let p=new L(t,n,i);return p.source="npm-module-checker",p.code=s,p.packageNameOrFilePath=e,p.line=a,p.startPos=o,p.endPos=d,p}se.exports=Re});var ce=w(($n,oe)=>{var{showOutput:Le}=G(),$=require("vscode"),S=require("fs"),v=require("path"),_e=ee(),Ue=te(),T=ie(),ae=require("module").builtinModules,Ve=["module","vscode","child_process","fs","path",...ae.map(t=>t.replace(/^node:/,"")),...ae.map(t=>"node:"+t.replace(/^node:/,""))];oe.exports=function(t,e,n){return function(i,a=!1){let o=$.workspace.getConfiguration("npmModuleChecker"),d=o.get("customIgnorePackages",[]),p=o.get("checkInsideStrings",!1),y=o.get("ignoreFilesOrFolders",[]),m={javascript:o.get("enableDiagnosticsJavascript",!0),typescript:o.get("enableDiagnosticsTypescript",!0),javascriptreact:o.get("enableDiagnosticsJavascriptreact",!0),typescriptreact:o.get("enableDiagnosticsTypescriptreact",!0)},r={packageInstalledGlobal:o.get("packageInstalledGlobalSeverity","Error"),missingPackageDependency:o.get("missingPackageDependencySeverity","Error"),packageInstalledDevDependency:o.get("packageInstalledDevDependencySeverity","Warning"),missingFileIndex:o.get("missingFileIndexSeverity","Error"),missingFile:o.get("missingFileSeverity","Error")};if(!m[i.languageId])return;let D=i.fileName;if(y.some(C=>{if(C.startsWith("/"))try{return new RegExp(C).test(D)}catch{return Le(`Invalid regex pattern: "${C}", check your settings`,!1),!1}else return C.includes("."),v.basename(D)===C}))return;let u=[],h=i.getText(),I=/(?:require\s*\(\s*["'`]([^"'`]+)["'`]\s*\)|import(?:\s+[\w*{},\s"'`]*from)?\s*["'`]([^"'`]+)["'`]\s*|import\s*\(\s*["'`]([^"'`]+)["'`]\s*\))/g,f;for(;f=I.exec(h);){let C=i.lineAt(i.positionAt(f.index).line).text||"";if(["//","/*","*"].some(l=>C.trim().startsWith(l)))continue;if(!p){let l=h.slice(0,f.index),F=h.slice(f.index+f[0].length);if((l.match(/"/g)||[]).length%2!==0||(l.match(/'/g)||[]).length%2!==0||(l.match(/`/g)||[]).length%2!==0||(F.match(/"/g)||[]).length%2!==0||(F.match(/'/g)||[]).length%2!==0||(F.match(/`/g)||[]).length%2!==0)continue}let g=f[1]||f[2]||f[3];if(!g||Ve.includes(g)||d.includes(g))continue;let Ne=f.index+f[0].indexOf(g)-1,je=f.index+f[0].indexOf(g)+g.length+1,b=i.positionAt(Ne),q=i.positionAt(je),A=i.positionAt(f.index).line,E=new $.Range(b,q),V=Ue(i.fileName);if(V)if(g.startsWith(".")||g.startsWith("/")){let l=v.resolve(v.dirname(i.fileName),g),F=v.extname(i.fileName);S.existsSync(l)&&S.lstatSync(l).isDirectory()&&!S.existsSync(l+"/index"+F)?u.push(T(E,l+"/index"+F,`Cannot find module 'index${F}' from '${l}'`,"create-file",$.DiagnosticSeverity[r.missingFileIndex||"Error"],A,b.character,q.character)):(v.extname(l)||(l=l+F),S.existsSync(l)||u.push(T(E,l,`Cannot find module '${l}'`,"create-file",$.DiagnosticSeverity[r.missingFile||"Error"],A,b.character,q.character)))}else{let l=JSON.parse(S.readFileSync(V,"utf-8"));if(!l.dependencies||!(g in l.dependencies)){let F=_e(t,g),Y=l.devDependencies&&g in l.devDependencies;F||Y?u.push(T(E,g,`Package "${g}" is not found in this project's dependencies, but is installed ${F?"globally":"as a dev dependency"}.`,"install-package-this-project",$.DiagnosticSeverity[F?r.packageInstalledGlobal||"Warning":r.packageInstalledDevDependency||"Warning"],A,b.character,q.character)):u.push(T(E,g,`Package "${g}" is not installed in this project's dependencies, devDependencies and globally.`,"install-package-global",$.DiagnosticSeverity[r.missingPackageDependency||"Error"],A,b.character,q.character))}}}return a&&(n.set(i.uri,u),e.set(i.uri,u)),u}}});var _=w((vn,le)=>{var Ye=require("vscode"),{outputChannel:ze,showOutput:re}=G();function Be(t,e){re(`
[Error]: ${t}`),re(e.toString()),Ye.window.showErrorMessage(`Failed: ${t}, check the output channel "${ze.name}" for more details.`)}le.exports=Be});var me=w((Mn,pe)=>{var He=require("vscode"),ge=require("fs"),ue=require("path"),Xe=["js","ts","jsx","tsx","mjs","cjs"];async function de(t,e,n){let s=ge.readdirSync(e);for(let i of s){let a=ue.join(e,i);if(ge.statSync(a).isDirectory())i!=="node_modules"&&await de(t,a,n);else if(Xe.includes(ue.extname(i).slice(1))){let o=await He.workspace.openTextDocument(a),d=t(o);n.set(a,d)}}}pe.exports=de});var xe=w((Dn,ke)=>{var he=require("vscode");function fe(t){return t==null||t==null}function Ze(t){he.window.tabGroups.all.flatMap(({tabs:e})=>e.map(n=>{if(fe(n)||fe(n.input))return;let s=n.input.uri;s&&he.workspace.openTextDocument(s).then(i=>{t(i,!0)})}))}ke.exports=Ze});var Pe=w((In,we)=>{var Fe=require("vscode"),{execSync:en}=require("child_process");function nn(t,e,n,s,i){Fe.window.withProgress({location:Fe.ProgressLocation.Notification,title:n,cancellable:!1},async()=>{try{en(t,{cwd:e,stdio:"pipe"}),s()}catch(a){i(a)}})}we.exports=nn});var $e=w((bn,Ce)=>{var ye=require("vscode"),tn=_();function sn(t,e,n,s,i){let a=e.filter(n),o=[],d=[];a.forEach(p=>{try{s(p),o.push(p.packageNameOrFilePath)}catch(y){tn(i(p),y),d.push(p.packageNameOrFilePath)}}),o.length>0&&ye.window.showInformationMessage(`Successfully processed ${o.length} items.`),d.length>0&&ye.window.showErrorMessage(`Failed to process ${d.length} items. Check the output channel "${t.name}" for details.`)}Ce.exports=sn});var Me=w((qn,ve)=>{var an=require("vscode");function on(t){return t===an.DiagnosticSeverity.Warning?"warning":" error "}function cn(t){let e="",n=!0,s=[];return t.forEach((i,a)=>{i.length!==0&&(e+=`${n?"":`
`}
	${a} (${i.length} issues)`,n=!1,i.forEach(o=>{let d=on(o.severity);e+=`
    ${o.line+1}:${o.startPos}  [${d}]  ${o.message}`,s.push(o.packageNameOrFilePath)}))}),{output:e,arrPackagesOrFiles:s}}ve.exports=cn});var c=require("vscode"),O=require("fs"),N=require("path"),{execSync:rn}=require("child_process"),De=H(),ln=ce(),{outputChannel:W,showOutput:x}=G(),j=_(),gn=me(),M=xe(),K=Pe(),Oe=$e(),un=Me(),Ie,U=new Map,be=c.languages.createDiagnosticCollection("npm-module-checker"),P;function dn(t){try{Ie=rn("npm root -g").toString().trim()}catch(n){j("Failed to get global node_modules path",n);return}P=ln(Ie,U,be);let e=[c.workspace.onDidOpenTextDocument(n=>P(n,!0)),c.workspace.onDidChangeTextDocument(n=>{n.document.fileName.includes("package.json")?M(P):P(n.document,!0)}),c.workspace.onDidCloseTextDocument(n=>be.delete(n.uri)),c.languages.registerCodeActionsProvider(["javascript","typescript"],new De,{providedCodeActionKinds:De.providedCodeActionKinds}),c.commands.registerCommand("npm-module-checker.validateIgnorePatterns",pn),...mn()];t.subscriptions.push(...e),c.workspace.textDocuments.forEach(n=>P(n,!0)),M(P),c.workspace.onDidChangeConfiguration(n=>{n.affectsConfiguration("npmModuleChecker")&&M(P)})}function pn(){let e=c.workspace.getConfiguration("npmModuleChecker").get("ignoreFilesOrFolders",[]),n=[];e.forEach((s,i)=>{if(s.startsWith("/"))try{new RegExp(s)}catch{n.push({pattern:s,index:i})}}),n.length?(c.window.showErrorMessage(`Found ${n.length} invalid regex patterns. Check the output channel for details.`,"Show Output","OK").then(s=>{s==="Show Output"&&W.show()}),x(`
[Validate ignore patterns] Found ${n.length} invalid regex patterns:`,!1),n.forEach(({pattern:s,index:i})=>{x(`- Pattern: "${s}", Index: ${i}`,!1)}),x('To fix the issues, update the "ignoreFilesOrFolders" setting in your settings.json file.',!1)):(c.window.showInformationMessage("No invalid regex patterns found"),x(`
[Validate ignore patterns] No invalid regex patterns found`,!1))}function mn(){return[c.commands.registerCommand("npm-module-checker.createFile",fn),c.commands.registerCommand("npm-module-checker.createAllMissingFiles",t=>{let e=U.get(t.uri)||[];Oe(W,e,n=>n.code==="create-file",n=>O.writeFileSync(n.packageNameOrFilePath,"","utf-8"),n=>`Cannot create file: ${n.packageNameOrFilePath}`),P(t,!0)}),c.commands.registerCommand("npm-module-checker.installPackage",qe),c.commands.registerCommand("npm-module-checker.installGlobalPackage",(t,e)=>qe(t,e,!0)),c.commands.registerCommand("npm-module-checker.installMissingPackagesFix",Se),c.commands.registerCommand("npm-module-checker.installMissingPackagesGloballyFix",t=>Se(t,!0)),...hn()]}function hn(){return[{name:"scanMissingPackagesInFolder",prefix:"Missing Packages Checker",type:"package",filterFn:e=>e.code.startsWith("install-package")},{name:"scanMissingModulesInFolder",prefix:"Missing Modules Checker",type:"module",filterFn:e=>e.code==="create-file"},{name:"scanMissingPackagesAndModulesInFolder",prefix:"Missing Packages and Modules Checker",type:"packageAndModule",filterFn:()=>!0}].map(({name:e,prefix:n,type:s,filterFn:i})=>c.commands.registerCommand(`npm-module-checker.${e}`,async a=>{O.lstatSync(a.fsPath).isFile()&&(a=c.Uri.file(N.dirname(a.fsPath)));let o=new Map;await gn(P,a.fsPath,o);let d=new Map;Array.from(o.keys()).forEach(m=>{d.set(m,o.get(m).filter(r=>i(r)))});let y=Array.from(d.values()).flat();if(y.length===0)c.window.showInformationMessage(`No issues found in ${a.fsPath}`);else{let m=[],r=[];y.forEach(u=>{u.code==="create-file"?m.push(u.packageNameOrFilePath):r.push(u.packageNameOrFilePath)}),m=[...new Set(m)],r=[...new Set(r)],c.window.showInformationMessage(`Found ${y.length} issues in ${a.fsPath}. Check the output channel "${W.name}" for details. Do you want to fix the issues?`,"Yes","No").then(u=>{if(u==="Yes"){if(s==="package")K(`npm install ${r.join(" ")} --prefix ${a.fsPath}`,void 0,`Installing ${r.length} missing packages...`,()=>c.window.showInformationMessage(`Installed ${r.length} packages successfully`),h=>j(`Cannot install packages: ${r.join(", ")}`,h));else if(s==="module")for(let h of m)try{O.writeFileSync(h,"","utf-8")}catch(I){x(`Cannot create file: ${h}, ${I}`)}else if(r.length>0&&K(`npm install ${r.join(" ")} --prefix ${a.fsPath}`,void 0,`Installing ${r.length} missing packages...`,()=>c.window.showInformationMessage(`Installed ${r.length} packages successfully`),h=>j(`Cannot install packages: ${r.join(", ")}`,h)),m.length>0)for(let h of m)try{O.writeFileSync(h,"","utf-8")}catch(I){x(`Cannot create file: ${h}, ${I}`)}}}),x(`
[${n}] Found ${y.length} issues in ${a.fsPath}:`);let{output:D}=un(d);x(D.slice(1)),x("To fix the issues, run the following commands:"),s==="package"?x(`npm install ${r.join(" ")} --prefix ${a.fsPath}`):s==="module"?x(`cd ${a.fsPath} && touch ${m.map(u=>`"${N.relative(a.fsPath,u)}"`).join(" ")}`):(r.length>0&&x(`npm install ${r.join(" ")} --prefix ${a.fsPath}`),m.length>0&&x(`cd ${a.fsPath} && touch ${m.map(u=>`"${N.relative(a.fsPath,u)}"`).join(" ")}`))}}))}function fn(t,e){Oe(W,[{packageNameOrFilePath:t}],()=>!0,n=>O.writeFileSync(n.packageNameOrFilePath,"","utf-8"),n=>`Cannot create file: ${n.packageNameOrFilePath}`),M(P)}function qe(t,e,n=!1){let s=n?`npm install -g ${t}`:`npm install ${t}`;K(s,n?void 0:N.dirname(e.fileName),`Installing ${t}...`,()=>c.window.showInformationMessage(`Installed package: ${t} successfully`),i=>j(`Cannot install package "${t}"`,i)),M(P)}function Se(t,e=!1){let s=(U.get(t.uri)||[]).filter(a=>a.code.startsWith("install-package")).map(a=>a.packageNameOrFilePath),i=e?`npm install -g ${s.join(" ")}`:`npm install ${s.join(" ")}`;K(i,e?void 0:N.dirname(t.fileName),`Installing ${s.length} missing packages...`,()=>c.window.showInformationMessage(`Installed ${s.length} packages successfully`),a=>j(`Cannot install packages: ${s.join(", ")}`,a)),M(P)}function kn(){}module.exports={activate:dn,deactivate:kn};
