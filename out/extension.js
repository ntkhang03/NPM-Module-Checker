var w=(t,e)=>()=>(e||t((e={exports:{}}).exports,e),e.exports);var H=w((Fn,B)=>{var k=require("vscode"),z=require("path"),J=class{static get providedCodeActionKinds(){return[k.CodeActionKind.QuickFix]}provideCodeActions(e,n,i){let s=i.diagnostics,c=[];return s.forEach(a=>{a.code==="create-file"?c.push(this.createFileQuickFix(a.packageNameOrFilePath,e),this.createFilesQuickFix(e)):a.code==="install-package-global"?c.push(this.installPackageQuickFix(a.packageNameOrFilePath,e),this.installPackageGlobalQuickFix(a.packageNameOrFilePath,e),this.installMissingPackagesFix(e),this.installMissingPackagesGloballyFix(e)):a.code==="install-package-this-project"&&c.push(this.installPackageQuickFix(a.packageNameOrFilePath,e),this.installMissingPackagesFix(e),this.installMissingPackagesGloballyFix(e))}),c}createFileQuickFix(e,n){let i=new k.CodeAction("Create missing file",k.CodeActionKind.QuickFix),s=z.resolve(z.dirname(n.fileName),e);return i.command={title:"Create file",command:"npm-module-checker.createFile",arguments:[s,n]},i}createFilesQuickFix(e){let n=new k.CodeAction("Fix all problems (create all missing files)",k.CodeActionKind.QuickFix);return n.command={title:"Create files",command:"npm-module-checker.createAllMissingFiles",arguments:[e]},n}installPackageQuickFix(e,n){let i=new k.CodeAction(`Install "${e}" package in this project`,k.CodeActionKind.QuickFix);return i.command={title:"Install package",command:"npm-module-checker.installPackage",arguments:[e,n]},i}installPackageGlobalQuickFix(e,n){let i=new k.CodeAction(`Install "${e}" package globally`,k.CodeActionKind.QuickFix);return i.command={title:"Install global package",command:"npm-module-checker.installGlobalPackage",arguments:[e,n]},i}installMissingPackagesFix(e){let n=new k.CodeAction("Fix all problems (install missing packages) in this project",k.CodeActionKind.QuickFix);return n.command={title:"Fix all problems (install missing packages) in this project",command:"npm-module-checker.installMissingPackagesFix",arguments:[e]},n}installMissingPackagesGloballyFix(e){let n=new k.CodeAction("Fix all problems (install missing packages) globally",k.CodeActionKind.QuickFix);return n.command={title:"Fix all problems (install missing packages) globally",command:"npm-module-checker.installMissingPackagesGloballyFix",arguments:[e]},n}};B.exports=J});var G=w((wn,X)=>{var Ae=require("vscode"),V=Ae.window.createOutputChannel("NPM package checker");function Ee(t,e=!0){V.appendLine(t),e&&V.show()}X.exports={outputChannel:V,showOutput:Ee}});var ee=w((yn,Z)=>{var Ge=require("fs"),Qe=require("path");function Te(t,e){try{let n=Qe.join(t,e);return Ge.existsSync(n)}catch{return!1}}Z.exports=Te});var te=w((Pn,ne)=>{var Ke=require("fs"),Q=require("path");function We(t){let e=Q.dirname(t);for(;e!==Q.parse(e).root;){let n=Q.join(e,"package.json");if(Ke.existsSync(n))return n;e=Q.dirname(e)}return null}ne.exports=We});var se=w((Cn,ie)=>{var Je=require("vscode"),R=class extends Je.Diagnostic{packageNameOrFilePath;line;startPos;endPos};function Ve(t,e,n,i,s,c,a,d){let p=new R(t,n,s);return p.source="npm-module-checker",p.code=i,p.packageNameOrFilePath=e,p.line=c,p.startPos=a,p.endPos=d,p}ie.exports=Ve});var oe=w(($n,ce)=>{var{showOutput:Re}=G(),$=require("vscode"),q=require("fs"),v=require("path"),Le=ee(),_e=te(),T=se(),ae=require("module").builtinModules,Ue=["module","vscode","child_process","fs","path",...ae.map(t=>t.replace(/^node:/,"")),...ae.map(t=>"node:"+t.replace(/^node:/,""))];ce.exports=function(t,e,n){return function(s,c=!1){let a=$.workspace.getConfiguration("npmModuleChecker"),d=a.get("customIgnorePackages",[]),p=a.get("checkInsideStrings",!1),P=a.get("ignoreFilesOrFolders",[]),m={javascript:a.get("enableDiagnosticsJavascript",!0),typescript:a.get("enableDiagnosticsTypescript",!0),javascriptreact:a.get("enableDiagnosticsJavascriptreact",!0),typescriptreact:a.get("enableDiagnosticsTypescriptreact",!0)},r={packageInstalledGlobal:a.get("packageInstalledGlobalSeverity",a.inspect("packageInstalledGlobalSeverity").defaultValue),missingPackageDependency:a.get("missingPackageDependencySeverity",a.inspect("missingPackageDependencySeverity").defaultValue),packageInstalledDevDependency:a.get("packageInstalledDevDependencySeverity",a.inspect("packageInstalledDevDependencySeverity").defaultValue),missingFileIndex:a.get("missingFileIndexSeverity",a.inspect("missingFileIndexSeverity").defaultValue),missingFile:a.get("missingFileSeverity",a.inspect("missingFileSeverity").defaultValue)};if(!m[s.languageId])return;let I=s.fileName;if(P.some(C=>{if(C.startsWith("/"))try{return new RegExp(C).test(I)}catch{return Re(`Invalid regex pattern: "${C}", check your settings`,!1),!1}else return C.includes("."),v.basename(I)===C}))return;let u=[],f=s.getText(),M=/(?:require\s*\(\s*["'`]([^"'`]+)["'`]\s*\)|import(?:\s+[\w*{},\s"'`]*from)?\s*["'`]([^"'`]+)["'`]\s*|import\s*\(\s*["'`]([^"'`]+)["'`]\s*\))/g,h;for(;h=M.exec(f);){let C=s.lineAt(s.positionAt(h.index).line).text||"";if(["//","/*","*"].some(l=>C.trim().startsWith(l)))continue;if(!p){let l=f.slice(0,h.index),F=f.slice(h.index+h[0].length);if((l.match(/"/g)||[]).length%2!==0||(l.match(/'/g)||[]).length%2!==0||(l.match(/`/g)||[]).length%2!==0||(F.match(/"/g)||[]).length%2!==0||(F.match(/'/g)||[]).length%2!==0||(F.match(/`/g)||[]).length%2!==0)continue}let g=h[1]||h[2]||h[3];if(!g||Ue.includes(g)||d.includes(g))continue;let Ne=h.index+h[0].indexOf(g)-1,je=h.index+h[0].indexOf(g)+g.length+1,S=s.positionAt(Ne),b=s.positionAt(je),A=s.positionAt(h.index).line,E=new $.Range(S,b),U=_e(s.fileName);if(U)if(g.startsWith(".")||g.startsWith("/")){let l=v.resolve(v.dirname(s.fileName),g),F=v.extname(s.fileName);q.existsSync(l)&&q.lstatSync(l).isDirectory()&&!q.existsSync(l+"/index"+F)?u.push(T(E,l+"/index"+F,`Cannot find module 'index${F}' from '${l}'`,"create-file",$.DiagnosticSeverity[r.missingFileIndex||"Error"],A,S.character,b.character)):(v.extname(l)||(l=l+F),q.existsSync(l)||u.push(T(E,l,`Cannot find module '${l}'`,"create-file",$.DiagnosticSeverity[r.missingFile||"Error"],A,S.character,b.character)))}else{let l=JSON.parse(q.readFileSync(U,"utf-8"));if(!l.dependencies||!(g in l.dependencies)){let F=Le(t,g),Y=l.devDependencies&&g in l.devDependencies;F||Y?u.push(T(E,g,`Package "${g}" is not found in this project's dependencies, but is installed ${F?"globally":"as a dev dependency"}.`,"install-package-this-project",$.DiagnosticSeverity[F?r.packageInstalledGlobal||"Warning":r.packageInstalledDevDependency||"Warning"],A,S.character,b.character)):u.push(T(E,g,`Package "${g}" is not installed in this project's dependencies, devDependencies and globally.`,"install-package-global",$.DiagnosticSeverity[r.missingPackageDependency||"Error"],A,S.character,b.character))}}}return c&&(n.set(s.uri,u),e.set(s.uri,u)),u}}});var L=w((vn,le)=>{var Ye=require("vscode"),{outputChannel:ze,showOutput:re}=G();function Be(t,e){re(`
[Error]: ${t}`),re(e.toString()),Ye.window.showErrorMessage(`Failed: ${t}, check the output channel "${ze.name}" for more details.`)}le.exports=Be});var me=w((Dn,pe)=>{var He=require("vscode"),ge=require("fs"),ue=require("path"),Xe=["js","ts","jsx","tsx","mjs","cjs"];async function de(t,e,n){let i=ge.readdirSync(e);for(let s of i){let c=ue.join(e,s);if(ge.statSync(c).isDirectory())s!=="node_modules"&&await de(t,c,n);else if(Xe.includes(ue.extname(s).slice(1))){let a=await He.workspace.openTextDocument(c),d=t(a);n.set(c,d)}}}pe.exports=de});var xe=w((In,ke)=>{var fe=require("vscode");function he(t){return t==null||t==null}function Ze(t){fe.window.tabGroups.all.flatMap(({tabs:e})=>e.map(n=>{if(he(n)||he(n.input))return;let i=n.input.uri;i&&fe.workspace.openTextDocument(i).then(s=>{t(s,!0)})}))}ke.exports=Ze});var ye=w((Mn,we)=>{var Fe=require("vscode"),{execSync:en}=require("child_process");function nn(t,e,n,i,s){Fe.window.withProgress({location:Fe.ProgressLocation.Notification,title:n,cancellable:!1},async()=>{try{en(t,{cwd:e,stdio:"pipe"}),i()}catch(c){s(c)}})}we.exports=nn});var $e=w((Sn,Ce)=>{var Pe=require("vscode"),tn=L();function sn(t,e,n,i,s){let c=e.filter(n),a=[],d=[];c.forEach(p=>{try{i(p),a.push(p.packageNameOrFilePath)}catch(P){tn(s(p),P),d.push(p.packageNameOrFilePath)}}),a.length>0&&Pe.window.showInformationMessage(`Successfully processed ${a.length} items.`),d.length>0&&Pe.window.showErrorMessage(`Failed to process ${d.length} items. Check the output channel "${t.name}" for details.`)}Ce.exports=sn});var De=w((bn,ve)=>{var an=require("vscode");function cn(t){return t===an.DiagnosticSeverity.Warning?"warning":" error "}function on(t){let e="",n=!0,i=[];return t.forEach((s,c)=>{s.length!==0&&(e+=`${n?"":`
`}
	${c} (${s.length} issues)`,n=!1,s.forEach(a=>{let d=cn(a.severity);e+=`
    ${a.line+1}:${a.startPos}  [${d}]  ${a.message}`,i.push(a.packageNameOrFilePath)}))}),{output:e,arrPackagesOrFiles:i}}ve.exports=on});var o=require("vscode"),O=require("fs"),N=require("path"),{execSync:rn}=require("child_process"),Ie=H(),ln=oe(),{outputChannel:W,showOutput:x}=G(),j=L(),gn=me(),D=xe(),K=ye(),Oe=$e(),un=De(),Me,_=new Map,Se=o.languages.createDiagnosticCollection("npm-module-checker"),y;function dn(t){try{Me=rn("npm root -g").toString().trim()}catch(n){j("Failed to get global node_modules path",n);return}y=ln(Me,_,Se);let e=[o.workspace.onDidOpenTextDocument(n=>y(n,!0)),o.workspace.onDidChangeTextDocument(n=>{n.document.fileName.includes("package.json")?D(y):y(n.document,!0)}),o.workspace.onDidCloseTextDocument(n=>Se.delete(n.uri)),o.languages.registerCodeActionsProvider(["javascript","typescript"],new Ie,{providedCodeActionKinds:Ie.providedCodeActionKinds}),o.commands.registerCommand("npm-module-checker.validateIgnorePatterns",pn),...mn()];t.subscriptions.push(...e),o.workspace.textDocuments.forEach(n=>y(n,!0)),D(y),o.workspace.onDidChangeConfiguration(n=>{n.affectsConfiguration("npmModuleChecker")&&D(y)})}function pn(){let e=o.workspace.getConfiguration("npmModuleChecker").get("ignoreFilesOrFolders",[]),n=[];e.forEach((i,s)=>{if(i.startsWith("/"))try{new RegExp(i)}catch{n.push({pattern:i,index:s})}}),n.length?(o.window.showErrorMessage(`Found ${n.length} invalid regex patterns. Check the output channel for details.`,"Show Output","OK").then(i=>{i==="Show Output"&&W.show()}),x(`
[Validate ignore patterns] Found ${n.length} invalid regex patterns:`,!1),n.forEach(({pattern:i,index:s})=>{x(`- Pattern: "${i}", Index: ${s}`,!1)}),x('To fix the issues, update the "ignoreFilesOrFolders" setting in your settings.json file.',!1)):(o.window.showInformationMessage("No invalid regex patterns found"),x(`
[Validate ignore patterns] No invalid regex patterns found`,!1))}function mn(){return[o.commands.registerCommand("npm-module-checker.createFile",hn),o.commands.registerCommand("npm-module-checker.createAllMissingFiles",t=>{let e=_.get(t.uri)||[];Oe(W,e,n=>n.code==="create-file",n=>O.writeFileSync(n.packageNameOrFilePath,"","utf-8"),n=>`Cannot create file: ${n.packageNameOrFilePath}`),y(t,!0)}),o.commands.registerCommand("npm-module-checker.installPackage",be),o.commands.registerCommand("npm-module-checker.installGlobalPackage",(t,e)=>be(t,e,!0)),o.commands.registerCommand("npm-module-checker.installMissingPackagesFix",qe),o.commands.registerCommand("npm-module-checker.installMissingPackagesGloballyFix",t=>qe(t,!0)),...fn()]}function fn(){return[{name:"scanMissingPackagesInFolder",prefix:"Missing Packages Checker",type:"package",filterFn:e=>e.code.startsWith("install-package")},{name:"scanMissingModulesInFolder",prefix:"Missing Modules Checker",type:"module",filterFn:e=>e.code==="create-file"},{name:"scanMissingPackagesAndModulesInFolder",prefix:"Missing Packages and Modules Checker",type:"packageAndModule",filterFn:()=>!0}].map(({name:e,prefix:n,type:i,filterFn:s})=>o.commands.registerCommand(`npm-module-checker.${e}`,async c=>{O.lstatSync(c.fsPath).isFile()&&(c=o.Uri.file(N.dirname(c.fsPath)));let a=new Map;await gn(y,c.fsPath,a);let d=new Map;Array.from(a.keys()).forEach(m=>{d.set(m,a.get(m).filter(r=>s(r)))});let P=Array.from(d.values()).flat();if(P.length===0)o.window.showInformationMessage(`No issues found in ${c.fsPath}`);else{let m=[],r=[];P.forEach(u=>{u.code==="create-file"?m.push(u.packageNameOrFilePath):r.push(u.packageNameOrFilePath)}),m=[...new Set(m)],r=[...new Set(r)],o.window.showInformationMessage(`Found ${P.length} issues in ${c.fsPath}. Check the output channel "${W.name}" for details. Do you want to fix the issues?`,"Yes","No").then(u=>{if(u==="Yes"){if(i==="package")K(`npm install ${r.join(" ")} --prefix ${c.fsPath}`,void 0,`Installing ${r.length} missing packages...`,()=>o.window.showInformationMessage(`Installed ${r.length} packages successfully`),f=>j(`Cannot install packages: ${r.join(", ")}`,f));else if(i==="module")for(let f of m)try{O.writeFileSync(f,"","utf-8")}catch(M){x(`Cannot create file: ${f}, ${M}`)}else if(r.length>0&&K(`npm install ${r.join(" ")} --prefix ${c.fsPath}`,void 0,`Installing ${r.length} missing packages...`,()=>o.window.showInformationMessage(`Installed ${r.length} packages successfully`),f=>j(`Cannot install packages: ${r.join(", ")}`,f)),m.length>0)for(let f of m)try{O.writeFileSync(f,"","utf-8")}catch(M){x(`Cannot create file: ${f}, ${M}`)}}}),x(`
[${n}] Found ${P.length} issues in ${c.fsPath}:`);let{output:I}=un(d);x(I.slice(1)),x("To fix the issues, run the following commands:"),i==="package"?x(`npm install ${r.join(" ")} --prefix ${c.fsPath}`):i==="module"?x(`cd ${c.fsPath} && touch ${m.map(u=>`"${N.relative(c.fsPath,u)}"`).join(" ")}`):(r.length>0&&x(`npm install ${r.join(" ")} --prefix ${c.fsPath}`),m.length>0&&x(`cd ${c.fsPath} && touch ${m.map(u=>`"${N.relative(c.fsPath,u)}"`).join(" ")}`))}}))}function hn(t,e){Oe(W,[{packageNameOrFilePath:t}],()=>!0,n=>O.writeFileSync(n.packageNameOrFilePath,"","utf-8"),n=>`Cannot create file: ${n.packageNameOrFilePath}`),D(y)}function be(t,e,n=!1){let i=n?`npm install -g ${t}`:`npm install ${t}`;K(i,n?void 0:N.dirname(e.fileName),`Installing ${t}...`,()=>o.window.showInformationMessage(`Installed package: ${t} successfully`),s=>j(`Cannot install package "${t}"`,s)),D(y)}function qe(t,e=!1){let i=(_.get(t.uri)||[]).filter(c=>c.code.startsWith("install-package")).map(c=>c.packageNameOrFilePath),s=e?`npm install -g ${i.join(" ")}`:`npm install ${i.join(" ")}`;K(s,e?void 0:N.dirname(t.fileName),`Installing ${i.length} missing packages...`,()=>o.window.showInformationMessage(`Installed ${i.length} packages successfully`),c=>j(`Cannot install packages: ${i.join(", ")}`,c)),D(y)}function kn(){}module.exports={activate:dn,deactivate:kn};
